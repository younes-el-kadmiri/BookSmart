{% extends "base.html" %}
{% block title %}Admin - Livres{% endblock %}
{% block content %}
<section class="hero">
  <h1>Gestion des livres</h1>
</section>

<div class="card">
  <div class="row">
    <input id="t" class="input" placeholder="Titre">
    <input id="a" class="input" placeholder="Auteur">
    <input id="p" class="input" placeholder="Prix">
    <button class="btn ok" onclick="addBook()">Ajouter</button>
  </div>
</div>

<div class="card section">
  <table class="table" id="tbl">
    <thead><tr><th>ID</th><th>Titre</th><th>Auteur</th><th>Prix</th><th>Actions</th></tr></thead>
    <tbody id="tbody"></tbody>
  </table>
</div>
{% endblock %}
{% block scripts %}
<script>
async function loadBooks(){
  const r = await fetch('/livres?skip=0&limit=100');
  const data = await r.json();
  const tb = document.getElementById('tbody');
  tb.innerHTML = data.map(b => `
    <tr>
      <td>${b.id_livre}</td>
      <td>${b.titre}</td>
      <td>${b.auteur}</td>
      <td>${b.prix ?? '-'}</td>
      <td><a href="/livre.html?id=${b.id_livre}">Ouvrir</a></td>
    </tr>
  `).join('');
}
async function addBook(){
  const payload = { titre: t.value, auteur: a.value, prix: Number(p.value || 0), disponible: true };
  const r = await fetch('/livres/', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(payload)});
  if(!r.ok){ alert('Erreur ajout'); return; }
  await loadBooks();
}
loadBooks();
</script>
{% endblock %}
